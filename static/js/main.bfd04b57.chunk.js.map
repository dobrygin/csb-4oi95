{"version":3,"sources":["index.js"],"names":["normalizeBoxSize","box","_box","Object","_tmp_deploys_4oi95_ckpiawxxy000m0us8bly3ei97_source_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_2__","x","y","width","height","Math","round","abs","App","videoRef","useRef","canvasRef","useEffect","document","addEventListener","handleMouseUp","handleMouseMove","removeEventListener","_useState","useState","_useState2","setBox","_useState3","_useState4","drawing","setDrawing","handleMouseDown","useCallback","e","clientX","clientY","touches","canvasRect","current","getBoundingClientRect","mX","left","mY","top","min","max","_ref","_ref2","renderBox","ctx","getContext","clearRect","canvas","lineWidth","strokeStyle","strokeRect","trackAndRender","_ref3","_tmp_deploys_4oi95_ckpiawxxy000m0us8bly3ei97_source_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__","_tmp_deploys_4oi95_ckpiawxxy000m0us8bly3ei97_source_node_modules_babel_preset_react_app_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default","a","mark","_callee2","tracker","wrap","_context2","prev","next","requestAnimationFrame","_callee","_context","sent","stop","_x","apply","this","arguments","onseeked","_normalizeBoxSize","_normalizeBoxSize2","xmin","ymin","console","log","undefined","objectTracker","init","play","currentTime","handleVideoLoad","_callee3","_context3","videoWidth","videoHeight","_normalizeBoxSize3","_normalizeBoxSize4","react__WEBPACK_IMPORTED_MODULE_3___default","createElement","Fragment","style","position","draggable","onMouseDown","onTouchStart","ref","crossOrigin","src","muted","onLoadedData","border","rootElement","getElementById","ReactDOM","render"],"mappings":"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","file":"static/js/main.bfd04b57.chunk.js","sourcesContent":["import React, { useCallback, useRef, useEffect, useState } from \"react\";\nimport ReactDOM from \"react-dom\";\nimport objectTracker from \"@cloud-annotations/object-tracking\";\n\nimport \"./styles.css\";\n\nconst VIDEO = \"/sample.mp4\";\n\nconst normalizeBoxSize = (box) => {\n  if (!box) {\n    return [0, 0, 0, 0];\n  }\n  const [x, y, width, height] = box;\n  return [\n    Math.round(width < 0 ? x - Math.abs(width) : x),\n    Math.round(height < 0 ? y - Math.abs(height) : y),\n    Math.round(Math.abs(width)),\n    Math.round(Math.abs(height))\n  ];\n};\n\nconst App = () => {\n  const videoRef = useRef();\n  const canvasRef = useRef();\n\n  useEffect(() => {\n    document.addEventListener(\"mouseup\", handleMouseUp);\n    document.addEventListener(\"mousemove\", handleMouseMove);\n    document.addEventListener(\"touchend\", handleMouseUp);\n    document.addEventListener(\"touchmove\", handleMouseMove);\n    return () => {\n      document.removeEventListener(\"mouseup\", handleMouseUp);\n      document.removeEventListener(\"mousemove\", handleMouseMove);\n      document.removeEventListener(\"touchend\", handleMouseUp);\n      document.removeEventListener(\"touchmove\", handleMouseMove);\n    };\n  });\n\n  const [box, setBox] = useState();\n  const [drawing, setDrawing] = useState(false);\n  const handleMouseDown = useCallback((e) => {\n    setDrawing(true);\n    e = (() => {\n      if (e.clientX && e.clientY) {\n        return e;\n      }\n      return e.touches[0];\n    })();\n\n    // bug fix for mobile safari thinking there is a scroll.\n    const canvasRect = canvasRef.current.getBoundingClientRect();\n\n    const mX = e.clientX - canvasRect.left;\n    const mY = e.clientY - canvasRect.top;\n\n    setBox([\n      Math.min(canvasRef.current.width, Math.max(0, mX)),\n      Math.min(canvasRef.current.height, Math.max(0, mY)),\n      0,\n      0\n    ]);\n  }, []);\n\n  const handleMouseMove = useCallback(\n    (e) => {\n      if (!drawing) {\n        return;\n      }\n      e = (() => {\n        if (e.clientX && e.clientY) {\n          return e;\n        }\n        return e.touches[0];\n      })();\n\n      const canvasRect = canvasRef.current.getBoundingClientRect();\n      const mX = Math.min(\n        canvasRef.current.width,\n        Math.max(0, e.clientX - canvasRect.left)\n      );\n      const mY = Math.min(\n        canvasRef.current.height,\n        Math.max(0, e.clientY - canvasRect.top)\n      );\n\n      setBox(([x, y]) => [x, y, mX - x, mY - y]);\n    },\n    [drawing]\n  );\n\n  const renderBox = useCallback((box) => {\n    const ctx = canvasRef.current.getContext(\"2d\");\n    ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n    ctx.lineWidth = 2;\n    ctx.strokeStyle = \"yellow\";\n    ctx.strokeRect(box[0], box[1], box[2], box[3]);\n  }, []);\n\n  const trackAndRender = useCallback(\n    async (tracker) => {\n      requestAnimationFrame(async () => {\n        const box = await tracker.next(videoRef.current);\n        renderBox(box);\n        trackAndRender(tracker);\n      });\n    },\n    [renderBox]\n  );\n\n  const handleMouseUp = useCallback(() => {\n    setDrawing(false);\n    videoRef.current.onseeked = () => {\n      const [xmin, ymin, width, height] = normalizeBoxSize(box);\n      console.log(xmin, ymin, width, height);\n      setBox(undefined);\n      renderBox([xmin, ymin, width, height]);\n      const tracker = objectTracker.init(videoRef.current, [\n        xmin,\n        ymin,\n        width,\n        height\n      ]);\n      videoRef.current.play();\n      trackAndRender(tracker);\n    };\n\n    videoRef.current.currentTime = 0;\n  }, [box, trackAndRender, renderBox]);\n\n  const handleVideoLoad = useCallback(async () => {\n    canvasRef.current.width = videoRef.current.videoWidth;\n    canvasRef.current.height = videoRef.current.videoHeight;\n  }, []);\n\n  const [xmin, ymin, width, height] = normalizeBoxSize(box);\n  return (\n    <>\n      <h1>Draw a box to start tracking</h1>\n      <div\n        style={{\n          position: \"relative\"\n        }}\n        draggable={false}\n        onMouseDown={handleMouseDown}\n        onTouchStart={handleMouseDown}\n      >\n        <video\n          ref={videoRef}\n          crossOrigin=\"anonymous\"\n          src={VIDEO}\n          muted\n          onLoadedData={handleVideoLoad}\n          width=\"480\"\n          height=\"360\"\n        />\n        <canvas ref={canvasRef} />\n\n        {box && (\n          <div\n            style={{\n              position: \"absolute\",\n              left: xmin,\n              top: ymin,\n              width: width,\n              height: height,\n              border: \"2px solid yellow\"\n            }}\n          />\n        )}\n      </div>\n    </>\n  );\n};\n\nconst rootElement = document.getElementById(\"root\");\nReactDOM.render(<App />, rootElement);\n"],"sourceRoot":""}